#  Техическое решение

## **Кратко основная идея реализации**

В результате реализации будет доступен новый сервис, работающий для функционала TODO-листа.

## **Изменяемые микросервисы или инфраструктурные сервисы**

- Для реализации сервиса предлагается следующий стек технологий:
    - **Backend:**
        - Язык: JavaScript
        - Фреймворк: Express.js
        - БД: Mongodb которая будет удаленно работать на сервере преподавателя
        - ORM: mongoose
    - **Frontend:**
        - Технологии: Html + css статика
        - Скриптовый язык: JavaScript - статика для работы с сервером
    - **Load Balancing (опционально):**
        - Технологии: NGNIX
## **Особенности деплоя**
    - **Deployment:**
	- Удаленный сервер: RPM-based Linux (Ubuntu, Debian, etc.)
	- Технология доставки кода: GitHub
	- Технология разворачивания микросервисов: Docker с Docker Compose для простой оркестрации

## **Контракт взаимодействия с клиентами**

- **API interfaces:**

| Создание задачи |  |
| --- | --- |
| Endpoint | POST /api/todo/createTask |
| Description | Метод для создания задачи |
| Request | interface Request {
  name: string; // min: 1; max: 160 символов
  folderId?: string; // id папки. В случае, если не будет выставлено, то попадет в папку по умолчанию
  description?: string; // min: 1 если не undefined; max: 4096 символов
} |
| Response | interface Response {
  // ничего не возвращается после создания задачи
}; |
| Errors | 
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_VALIDATION_FAILED - переданы невалидные входные параметры
• ERR_FOLDER_NOT_FOUND - не найдена указанная папка |

___

| Создание папки |  |
| --- | --- |
| Endpoint | POST /api/todo/createFolder |
| Description | Метод для создания папки |
| Request | interface Request {
  name: string; // min: 1; max: 160 символов
  description?: string; // min: 1 если не undefined; max: 4096 символов
} |
| Response | interface Response {
  // ничего не возвращается после создания папки
}; |
| Errors | 
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_VALIDATION_FAILED - переданы невалидные входные параметры |

___

| Редактирование задачи | |
| --- | --- |
| Endpoint | POST /api/todo/editTask |
| Description | Метод для редактирования задачи |
| Request | interface Request {
taskId: string; // идентификатор задачи для редактирования
name?: string; // min: 1; max: 160 символов - новое название задачи, если указано
folderId?: string; // id новой папки. Если не указано, задача остается в текущей папке
description?: string; // min: 1 если не undefined; max: 4096 символов - новое описание задачи, если указано
} |
| Response | interface Response {
// ничего не возвращается после редактирования задачи
}; |
| Errors |
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_VALIDATION_FAILED - переданы невалидные входные параметры
• ERR_TASK_NOT_FOUND - задача с указанным идентификатором не найдена

___

| Редактирование папки | |
| --- | --- |
| Endpoint | POST /api/todo/editFolder |
| Description | Метод для редактирования папки |
| Request | interface Request {
folderId: string; // идентификатор папки для редактирования
name: string; // min: 1; max: 160 символов - новое название папки
} |
| Response | interface Response {
// ничего не возвращается после редактирования папки
}; |
| Errors |
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_VALIDATION_FAILED - переданы невалидные входные параметры
• ERR_FOLDER_NOT_FOUND - указанная папка не найдена

___

| Удаление задачи |  |
| --- | --- |
| Endpoint | POST /api/todo/deleteTask |
| Description | Метод для удаления задачи |
| Request | interface Request {
  getFolderTasks(taskId); // получает id нужной задачи
} |
| Response | interface Response {
  // ничего не возвращается после удаления задачи
}; |
| Errors | 
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_TASK_NOT_FOUND - не найдена указанная задача
• ERR_FOLDER_NOT_FOUND - не найдена указанная папка |

___

| Удаление папки |  |
| --- | --- |
| Endpoint | POST /api/todo/deleteFolder |
| Description | Метод для удаления папки |
| Request | interface Request {
  getFolders(folderId); // получает id нужной папки
} |
| Warning | interface Warning {
  // предупреждение пользователя о том, что вместе с папкой удалятся все задачи, находящиеся в ней
}; |
| Response | interface Response {
  // ничего не возвращается после удаления папки
}; |
| Errors | 
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_FOLDER_NOT_FOUND - не найдена указанная папка |

___

| Получение задач |  |
| --- | --- |
| Endpoint | POST /api/todo/getFolderTasks |
| Description | Метод для получения id задач |
| Request | interface Request {
  getFolders(folderId); // получает id нужной папки
} |
| Response | interface Response {
  taskIds[]: string;
}; |
| Errors | 
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_TASKS_NOT_FOUND - не найдены задачи
• ERR_FOLDER_NOT_FOUND - не найдена указанная папка |

___

| Получение папки |  |
| --- | --- |
| Endpoint | POST /api/todo/getFolders |
| Description | Метод для получения id папок |
| Request | interface Request {
  // ничего не принимает на вход
} |
| Response | interface Response {
  folderIds[]: string;
}; |
| Errors | 
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении |

___

|| Авторизация | |
| --- | --- |
| Endpoint | POST /api/auth |
| Description | Метод для авторизации |
| Request | interface Request {
email: string; // min: 6; max: 320 символов
password: string; // min: 8; max: 160 символов
} |
| Response | interface Response {
token: string; // Токен доступа, используется для аутентификации пользователя в последующих запросах
}; |
| Errors |
• ERR_USER_NOT_AUTH - пользователь не авторизован в приложении
• ERR_VALIDATION_FAILED - переданы невалидные входные параметры
• ERR_INCORRECT_PASSWORD - неверный пароль
• ERR_USER_NOT_FOUND - пользователь с указанным email не найден
• ERR_EMAIL_NOT_VERIFIED - email не подтвержден
• ERR_TOO_MANY_ATTEMPTS - слишком много попыток входа, попробуйте позже |

## **Детальное описание ТР**

Будет создан новый сервис - `todo-service` в рамках которого реализован функционал TODO-листа.

- Необходимы методы авторизации, регистрации и синхронизации между устройствами

### Авторизация

Авторизацию планируется реализовать с помощью предоставления логина и пароля пользователем на интерфейсе.

В качестве логина, соответсвенно, сервер будет ожидать email. Далее нужно нажать кнопку `Авторизироваться`, чтобы войти в аккаунт.

- Возможно ввести двухфакторную аутентификацию через стороннее приложение или по почте

### Регистрация

Регистрацию планируется реализовать с помощью ввода логина, имени, фамилии, пароля и подтверждения придуманного пароля пользователем на интерфейсе. Все данные поля будут являться обязательными к заполнению.

В качестве логина сервер будет ожидать email. Сервис автоматически проверит существование введённой почты.

В полях `Имя` и `Фамилия` могут быть использованны кириллица (заглавные и строчные буквы) и специальный символ `-`. Поле пароля принимает латиницу (заглавные и строчные буквы) и числа. Поле `Подтверждение пароля` сравнивает идентичность введённого в данном поле и в поле `Пароль`. Для этих полей сервис будет автоматически проверять наличие запрещённых символов.

После заполнения всех полей, если они заполнены корректно, нужно нажать кнопку `Зарегестрироваться`, далее потребуется подтвердить почту и создание аккаунта посредством перехода по ссылке в полученном на введённой почте письме.

### Синхронизация данных между устройствами

Все папки и задачи будут привязаны к аккаунту. Неважно с какого уст-ва пользователь зашёл в аккаунт, он будет видеть папки и задачи, которые имеются на данном аккаунте.

- Возможно реализовать изменение фронтенд части в зависимости от типа устройства, некритично.

### Папки

**Папка** - представляет собой список для задач.

1. Пользователь должен иметь возможность создавать, редактировать и удалять папки для группировки задач. К  чужим задачам он не имеет доступа.
2. У пользователя есть возможность создавать папки, чтобы относить к ним задачи. Группировать их туда.
3. Если папка будет удалена, то находящиеся в ней задачи тоже должны быть удалены автоматически.

### Представление задач

**Задача** - сущность, создаваемая пользователем.

1. Пользователь должен иметь возможность создавать, редактировать и удалять задачи.
2. Задачи должны иметь следующие поля: название, описание, дата создания, дата выполнения, статус выполнения.
3. Задачи должны быть связаны с соответствующими папками. Можно сразу же получить список задач, относящихся к папке.

## **Использованная литература**

- Backend: `https://clck.ru/39KnyT`
- Frontend: `https://clck.ru/39Knyj`
- Deployment: `https://practicum.yandex.ru/blog/chto-takoe-deploy/#sposoby`
- API: `https://aws.amazon.com/ru/what-is/api/` `https://habr.com/ru/articles/464261/#nabor`
- REST API: `https://cloud.yandex.ru/ru/docs/glossary/rest-api`
